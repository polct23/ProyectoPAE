from typing import Optional, List
from fastapi import FastAPI, HTTPException, Depends, Request, Response, status
from fastapi.middleware.cors import CORSMiddleware
from fastapi.security import OAuth2PasswordBearer
from sqlmodel import SQLModel, Field, create_engine, Session, select
from passlib.context import CryptContext
import os
from dotenv import load_dotenv
from datetime import datetime, timedelta, timezone
from jose import jwt, JWTError
import uuid

load_dotenv()
DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./database.db")

# Security settings
SECRET_KEY = os.getenv("SECRET_KEY", "CHANGEME_GENERATE_A_STRONG_KEY")
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = int(os.getenv("ACCESS_TOKEN_EXPIRE_MINUTES", "15"))
REFRESH_TOKEN_EXPIRE_DAYS = int(os.getenv("REFRESH_TOKEN_EXPIRE_DAYS", "7"))

pwd_context = CryptContext(schemes=["pbkdf2_sha256"], deprecated="auto")

class User(SQLModel, table=True):
    __table_args__ = {"extend_existing": True}
    id: Optional[int] = Field(default=None, primary_key=True)
    username: str
    hashed_password: str

class RefreshToken(SQLModel, table=True):
    __table_args__ = {"extend_existing": True}
    id: Optional[int] = Field(default=None, primary_key=True)
    jti: str
    user_id: int
    expires_at: datetime
    revoked: bool = False

class Dataset(SQLModel, table=True):
    __table_args__ = {"extend_existing": True}
    id: Optional[int] = Field(default=None, primary_key=True)
    title: str
    description: str
    format: str
    lastUpdate: str
    category: str
    coverage: str
    link: str
    logo: Optional[str] = None

DATASETS = [
    {
      "id": 1,
      "title": "SCT – Incidències viàries Catalunya",
      "description": "Retencions, accidents/obres i estat general de la carretera",
      "format": "XML",
      "lastUpdate": "20/10/2025",
      "category": "Mobilitat",
      "coverage": "Catalunya (inclou AMB)",
      "link": "https://www.gencat.cat/transit/opendata/incidenciesGML.xml",
      "logo": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdoAAABqCAMAAAAsh2BcAAAAn1BMVEX////kBh/kBR/jAAD//v/kABjjABPkABz96u3jAAj3wsXkDCTqYmrxkZbpQlDoPEvsXGj63d/4xsv4ztHjAA7who/raG/yoqbznKP97/H++Pj61dn+9vf98fPwjJT85ef2ub70q7LtbXfvf4j0rrTlFiznKz3pTFjyl571u77yoKfmJjbqWGL3w8fnNkXueoTtdXzrUF/mIDH0tLboM0jsSU0XAAAWgElEQVR4nO1dC3viKhNWSIKpVavG1mu9x2ut1fP/f9sHJCrMAEabPafbz/c8z+6emBDghWGYGSaFwgN/KUZvAM3/ukYP5IQt1RDS9/+6Rg/kAa9QeA6IhrDyX1fqgZzwHBRVPKj9JfAe1P5WPKj9tXhQ+2vxoPbX4kHtr8WD2l+LB7W/Fg9qfy0e1P5a/BxqvdwLy7XEbyDfemQu7c9R+993rCf/+wHwlD+/0zHeTQ//nFn7Y/EjRscduInawXBguNpbrZ7qmS9bUW+sZuv1bPVxy0M2dHuitLfx6KlZ+n5pg+bqyAs7PjWH9xVQ6j2tZm/r8XHVqN85Urr1Bi9jLKqxemrUTURgZKS2OWGUhuXPnna13/Kll3fe1i53WoG8fFhnakmvXQ0Vj3FtKem9sxNKs8lBdUCzxbp3/Skrmi21tKBWyRapcK58s/3FlMbRcLOfldBdLvQ/ltu5WoQoxa9NZ/VrZQBqi5ha/nDpi0aMEcIiOlFGzCgMCSH8IZ/Olf47BpTJYeLTQ+9a/QfrmFKfFEk6tIrMD2ltdPo1rmrYWXvWE+8prWs0qWlaGq8yH2Xzd5cs6Cz0d/zzdK7bcs5LOxXGSxN1K78P07fZkS6vzX1Aw4CRc+fy+vgRpXElq2watqtUFkEUing9mCiG7D+6+InduSFzpjHL2EZpZVyS1eyVI16eqFiR0PgsltaUkfSdxA8bpxbJy0kVOOcNZ9X7S8J5hRXnY6KacNihvgb65CisN4moXySseCkvCS/g8+bZPttKLNDfcUyud9v+pYGn8ngPheG072xU2rS3nRwX51GbFsDrxwfI1ypDEaNtMupRIfKCmGiHClxx6pce05nljzG1lfLB0jwQRaf/BXHasIZseEpt0Wcp5R/0cpEPUuZaoFYbyooEdJ+8ECSBPB2qx4A4qB0+855MuTzPs+JpkAX01VaRUpnp70iobe7S9imVkx3A7zi4B6zAeMOHGW6bvMT/CGjNNUoFRjsapIOziDso+YEPvoo+c+v01APwxeKC0kpJ7Uuk3UH3iSI+97XL0UtSNmHaAJOXLeLrk+pFaPWgk4KgVr9KP2wdsYwi1BatvCham5/k1OrvkNSuXXXz6dhNS33neDwpI6DbjqMEvgb6aFgYwGis6RKc2usPiVYKapvwZirH/5iCN1Mp8970uwmjNi1mUHPWgtBnA7WWoT7cUebuCDFQX/DSVLBQ+wlbp4K/ys3tWsjRKxCSZGQt4chnLJysFvh0VrjMnpuo3UfgaihlZc0HC0DYEi+o6qOVkHBqnrWlOMLSSnmQczvNSu1TGCCphcsj4c4klE3UcmaZozj+o0OJ6E5c40JrYctSRCVZDLKxRCS3d1DrHeBy7MeiDFgE8Wv8aqcM7w4WxsoPYjhiDK8f9TNRO6YuHpQqBgcDtzq1cq1dXu8fVrbpUv2vjL17WnUw3un1Zy+FcKF8URJvohYNQcZ4EUNErbxcR3qZHxv7oBpdFzeMDbNQu74mjM9VJMEcr29g1hK6amYYKiT8NDPr1cKszIpxNDHItHXmsZHC35yXmhupBVeZ7xmpDUTJAbzb35ioda5lZwRboIyYqB2jLYqrxA3qSETtOL6+Ugq9zKxyL7IzK7nFMtkysvjc4TCXQ8/WiG/OWiIGJ5IZUk6XCJq1VcNKu6Im7Rw1hkA100DtR9Y5m6j+4YubWr4ChiyD/kJIZJy2e5pR+zkVg5T+7s4wsvhWOCLlMtfNaYR1b8LmJ0vSTdSiN/lVIUM24A0k2ouiY11lJ+llHYMDrJ5kmgVRGIaRb+8cSK1XGIb6ZkvylxQUBn6yAdReROEeCKpRp4onjxLrNvHSnae6cMyQMEvqEyYNM5Tjlwd6KUAcJ7v8aqvZG5aGw3pvtN/gWX3ajAtqgxNAs/hECS6Q25xWCPtXdk4F7YlWwv72HsKuNMjQlkFN4PUvP7fel++fXxGF1Tq/AxVWC6DBoxhRsv18X1Za+x2VU1rjnvlAkNqolVMlQWTUVim2KA2xxOSDm85fW5VK67NKDZsiuGh3gX2Qv5guNFtaf4ykGYlO+lhp+3rCBhTk714vkJtqOMUJlcOsQ/Un/dhLL2u3+zssj4eRwQZGn5snXaC72lp2/IjaJYXMBXRyLsgrrctUF6/kbFtxU1vkI6S2HNUH/UH9OKWm5c8gkZ8jOAT4iJ300vp4/eOOwpcxEtVVTepIi7qgAcuxuHU4hyLTpKxedw8UplSzytJlcnlNCTlvq8l5o5d09tk+Tw3G208oB/jQ3emWjd7OqI1AatEgYfSldO4BiQpghUCTFqZWylA6UWd327BM+DE0gXzoeokQv7SquwJGZSBm4JK18IHQpoY1vQdHdJFi1T+DU69bvQhZXsb2dJ3vzNMZIXri7Nd7PQ07ol2+YADFgNgDoLk9MekDkNrXSC+H0Tf0ugakX27ALzDMWsJXQGCSqHP1AE5I1J1Q/zDxUtrBJYQFio2/D5udSkOAlwCKUuBMyuiK71fPYoSp1rrpyczJlxOlS6c0ea9Y9Ux22zZYaTmzr4bbJoYFGVDbgxqH0XT3AYQgUEpN1DKGeqqHZC2yaK9wwwwzrjOHC67aS09IhTmiEjhtIwpFURPdk8kV71Uo12yYH1Ddxt4Q3sSIKxsvdePlZ6NfEqrHfH3HdeeogrWiiKh91VwCvCcNMqIgZLL+Pt1AZhLIJjNiJYTcwoFbg5M2+jJVBxnlg+3lxzZYiFjZGFIxpFAggxpnD6DpjLdz//A8hot1fdz6rMxQmEr97X1fmZk9Gz20P4DC5FRIiHasOrUlqiscgbEn+Yqi2yA4c0NlMTZQGxntf0gDAn3Vg2KGMXP8zgTYWAm9SMJnIGmDZ3Ob4Lvup/YmuEMQllCJspns+LbLRa2HZqNliMDdJjj6j6ll1GhoeocVD/R1BGmHxuWoIPYcdl5iCtAy9ydU2e+m9mqgpB5R4ry35kMtwsiIJ3eJzlk712d1ZFqxJfpztSC+d4+dszZAFiuJJmTEr6o/d6F9Ulh2zT2xAO4xRVNZt3UszT7Rbm7UWuEKrzU3q1MG5iNLRwrAnZlOLdgBYJPdBZ9Akw6V0YSpVZ1kanug64PF6s89Co01S1t1oOCKptaaW/CEvOXfoLbba5pmV9982Y4mEI7MoAKesELqokot6CB2sMdwNkBBqqhE1NoM/3CycRVH/bWiK0C8YdZI2SaUulXbnQhp3PwOWdfvpnYk40mjL7CvnNXk5e31WKEzxnBX64ieKkE/kkYtUEhtSpRsKHipKikQtf7OGI3Bd3VA/ZFuzDO2YL/q2/nqNgCyJ+tKVr4J1kLupLYeU5+ve4wFdKEQ0ROXk4DQReZYbj1og+Cdj4rY4dTrAvkY2kIWBEDwh2qXQ9RaV4gKkKMsUn4czIHVy2A9yQfeRxwWoVH7Tmob4UVBiMrndf0plDYx+VM0zyqWt4G+1Jo3Gik+wTxRqW2CHWBYGdZtGO5BMxWZi6i1rnxraJJQqR2ipfY7oe0JDNpKqdlKQupymbV1dnHUiUCFdILWA1UjDDau+DwFVbjHdA3umSPKAi3EEVzB1Lh/e08gaq01OoLaKLPWK4wg7zRbfzihcNupN4+t5xqhodFzch+1i0BzD4TpJnqndxc1+GUN6MdQ8R857ob9pVL7jhwIVj8v9sgpditMra1GsDaaQIZarx9bSrkVpcax8lw7kECcI/BtcQd3UStjxi/U8lLqaTuB7ymTSC7pS5IhykAFNPCo1E5g4LE9BBBfV4Quptam1Dy5qIU6VmDdZWfHcDb9R57xCXy5xTfFm58qfQ+1EyjMkm75AnvOjDviUhlS69Kuod1GpfYrSwSTDYojDVIr/JDmLbmT2tfr3tGb0G1ONyJaJmN00D3UenNoEkqDVXEQVJYawyAzo0P3creD2up3qFVMszlRC4e6xVWREaVlLGjN3qC7qKVQAjBfdjoUh/oG3lpnRK1r1rpCzL9FrX9x/pioNcNJLXT7fGfv020RcTDtlvbdQ20XuU3TYFVwNQlWvYrSHFLrOtbkmrXIhXYL/JrVhnwftR60D107FuRAU0T9GJglyYksGZmRx+bHEIcsglVhXD+ndpOl2oMNtGuPHHe71trvzdra2eKUE7Vx1i3UVbRtR8FOp+xYSKdlwO1dahT01KRHPZDlNZtKCKJsSdFuRC8I2y/orx9LLbLq2jx6VwEj+ZSaicPbfPe+2dcLcHtwF7XvyEYvRc0U7OOIxV8CsdAZcY8Il8ligeKjg+wIq3an3n3UAlNmMXQNWWeTzXs4Fghz/XyxX8tUFjCc5y5qh6H6LsJYEhMwVKogNlv+PMtZcRiwdcWG3HIYGmE8gl99yY6tfV9756zdAg05cpm07SihnYeIvedT9fC6nDUHZ1kT5eKvregS4qQfKHHi8ph1tkmL3SfEcW7e5R6YApl0rwTMhVoPmbtdjigHtsgQU/Qp2a/gvMll1oqviijUXs4NLi6SmjBT7J4RMJjFehy6YAgzVu+F3sHb/dkJcpq1MLxGKps3o0fRoSkajwzp63Kitvt8khLEVyjsv6SZZkROhcz9Cl3xwvVjC7hBpxFVaqF73RGtYULOmx8+0oqgGEd2pxJ0TZ0E7R5Sxui7sXegw/ZuV/y4TCPf5wv5YaRefmPp5ThLQpW0VXBYMsOZ17R66CSZSu0QiC4QOZ69QvlQW0dOPUefTKBnKqW2fwB5hOQyY+AWnZ+8P8rCW7Wqu0ULHRgcTau7r/cbgixMsR+2HeAIbak14Q0oYeX7srHlRG2HAVZcCwTfuCkvvVh7QHwVsYTNFkRSgj8a9nZfQjbkjGMW3boLlShALQyKu5KjyoacqIUBNEQPr7lAmPICPZ/ReS1Zg50PC4bmXoaO/7up9Yz/vBMoeJ5YFuopPhmiUQs3vaaTvBmqncu+1kN6FDo2ptVcJ+as3IOUMMS6yHwgLSSPWfttcvGZXqOSDPUSRC30Hdhmv8Rx2lIwVXZqec1aJEzV8x46gJcofSNmw671t2+ftWnmIAOGjafGnalFAeAOUKSkw72JzpcjapEByGG29RgNz4hCoeKchmhe1HowxJyFlugoGGAgXWkS0O5hbVENnhvMMGvNGRq67STB6OZ+d8YF6FyEMHiPwE0tY64OnVogkQkj1mkrrKWXtY3NlXDUvKiFgcjWvEpoSF5WEhjpbKMWuVSzUGusTpPJ45Zi/7r5fpwel0fo7Dijz4pI6K5ic+YkndouSBqIDryfGqkfbSS6aMqNWrgbS84P6LnUxb/byGhzpgVSa7NWQgO+UYeEAtlkRBkpKRj8qPHt5baBMwuJVBwv43qpMygNG63Y5tZSqPVE4gyql0EsX999CrUkM3pcf27Uohgac0zfB2y9crr+BZRgUaOGKDtXBmpNdr9mqOYE9mGajzvwBcOtSEIuJYfNPKShNSOXSm1Bmj+02UjMynZFTxcENov5UYuyfphOvYxQdmMl1AYez2TmMyoLnCnPQC0YaZy6DSjNqwWKe4CYRfZt6CH3RpoESCS9SnL6oLonDQDjTh7DVKItRR5GSExjp2YqkTmdtRbmRy0+OFtkdKqJuO4nPKKvHY6Ge359FJ5KekXiGJ/QLxioJT6bfgz7ntcfNmdCLUE2IWegWja8W5ySAMR55kf01MaHE8WnO+XMdmccawl9xKABMzsnf63AIMAZnUK/fa7OsEJDLEqV+LgGjABOIhVOZ2DlH6WqSQ/hPQOXyT1KIyyyY58ghjf0izpNA1kh0j1d5ZaEE7gZgKsFXLaJTJ1O40lr2W5X9iL5PewsmMorx1mLbBGJUKbVKa/N+35jWmq0NCRDPZZa/A/IGlGqUGPXGVZ1fPKcpIm2RbEiMQA+NL75vtmi5KOELhj+xhX2lmAKDQVSmLMo5Et2kjgOdARSbXKjVnQKzq0ik41HSW0MUfDa2zx5UgM8zPXLdo8rmKVSvdl+CZTc8VrPYHc5PMdyCa4qJlnMu+Zg1e+iF/rOeSuS9Ie9DElzaxFBx9ZcCKHBPc9ZW+jHgVVRMLUSpt+cYX+tyCpGg/J8XhZ/W9LgmQIR6mjWqvfbM6t+G83I3QlckI2ypLruHMSCkbk3A5THK1dqC8Pghmg8vsMGOqmHcvSldyYKph2mUCzkY1MgqYVROMVsseRXUY9do4pvoFfZEtQPD1nW7VOpDDnI86X2Nm6jGrSfwdgRG+BdJuNG21GW3NpDs1jRbva+Df2JPUU/ScxemRLU12P3FyXUqht8uvlS6xXqc5zvyoJoh6MQDNmyDPCh3DbFmPQt2ScFJLVLYBfLHOB2Has4/Y6N/gKhOnz2hVqS7dsDnSoVXwdy8yuUh2hTxxpgzrOWz9talpzIoiMXyObt8epcO8HFn4xiGD7kmwL84WlKBZLakmrVIiJrcR5LbYLueCPSyOnc+qFU+MVbsn4xZHrt2ytJ0OXCFKqT47721Kp9lgz3zHIiuXf1dB6jtX4f+iKoiZWpldvE1qoGnxFLHsT70dyXKY0C3xeKgu9HNDxUzsnYELW2QIrGBsfv6j3JJYHZFX3/rCUWaguFD4JNE4CesGyKnRJZSOpl5xc3eENa8hTGta4RXfhuW/NSM/qEpsY/mbv0vtBpF3rHz69afJgfNrvF51HdoSNq7d/UWxKa2iiRDaYoRfyX5Wg3/DqXi1rtPuus5ei+E4q+ulZM993CiRm07HEDg600tGAXirgW0IV0vk0ivdZcRTbN29WGnnO5k6Q3EgmWekim6QcNzx9E+wPoDjod1FpwHtCZ+qNT2SSGGrB28x7mIt6e/wh+U8+3UrsCX/jzXekqSu9zGkDzQsJrQMtT9zcXZzEiNxlMIV3INckrvIHKBHNzUeLbfmHAToPq5LY+29GfdkJoRhSkSv/jALnzRMJvGzzh5n0NKTSFiE9hHlqOZAydak1HbBs/jRjc+Y+9LhyD44v4HqnOjziOtR13CtCRC57uzqq6fUIKHj4keqdbhjtYbSM1olt6lS1LPo4qjGKKDTlBb71//lzn8eHgWwASg4h4VPtQl13yUamePvKa5p7ZvuUQPXAjTpXsr1ppPs1Tl8bT0WlnfeVLqcP1VmtI+NV2NsRZmtdpHN/S/I/r8agxtGQ9+yZuULBBlKA5ozdCqTk6vrWXb7PjRy/bGbM/imHjOHtbtt9mo5uDy0qNkXz0uGpm+9L0j4OVMKAGZnMV57c3e+BGaGGjInLUOpZBtBFx5ur7wfC0v34xQgBHclmoIF/7nG+C39+FPxXQKG09PN3XP8LJdw1/6YLzfwN4EpXYMiK/A1fxnaeRH/jXgL6ZwojxGGYjBJt217HGB34CuujblUGSD0ZfI3vw+3S5RHc88EcxQV9DivCnvo8oOez3UuM98G+gh31ePm1pQrn3he5h84fm+/PxaoiQDenLutfpDAadUqNSo+hYkDst3AM/BOKL8thpFVBKy/M5oaZE3QRFIj7wI/Fm8f4ngXuGX0gQP/a0fwcmKLo5YZAY46fFB6DdDs4Hfg6eqYVEU67YYuD/2+7EB+7HntoP5AGwMM4n1cID/w7W6AstNmbp62Od/bvQ22WI6eTEBqOHM+evw7gsw+2sa644LRu8/5lYjwf+LLzxjkbm45hEBiLu2g9Z/NeiKc43R/Dz8TJnd23afAjivxr9enuyScP+ToF/86/W7A9F3T3w78Lr1j9mbxLjUaPefczWP4//AbNQZ4YGtJzSAAAAAElFTkSuQmCC"
    },
    {
      "id": 2,
      "title": "SCT – Portal Open Data (Transport)",
      "description": "Incidències viàries i transport públic (Rodalies). Filtrable per comarca",
      "format": "XML",
      "lastUpdate": "20/10/2025",
      "category": "Mobilitat",
      "coverage": "Catalunya",
      "link": "https://analisi.transparenciacatalunya.cat/?sortBy=relevance&pageSize=20&category=Transport",
      "logo": "https://analisi.transparenciacatalunya.cat/api/assets/F28998AB-B856-4C08-8888-E8BA432E1CDF?logo_dades_obertes_transparent.png"
    },
    {
      "id": 3,
      "title": "Open Data BCN – Transport",
      "description": "Informació general sobre trànsit i mobilitat de vehicles i bicicletes",
      "format": "JSON / CSV",
      "lastUpdate": "20/10/2025",
      "category": "Mobilitat",
      "coverage": "Barcelona ciutat",
      "link": "https://opendata-ajuntament.barcelona.cat/data/ca/organitzacio/transport",
      "logo": "data:image/png;base64,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"
    },
    {
      "id": 4,
      "title": "TMB – Rutes i parades (Transit API)",
      "description": "Línies de bus i metro, parades i estat de servei",
      "format": "JSON / REST API",
      "lastUpdate": "20/10/2025",
      "category": "Transport públic",
      "coverage": "Catalunya",
      "link": "https://developer.tmb.cat/api-docs/v1/transit",
      "logo": "https://developer.tmb.cat/vendors/tmb-theme/images/theme/png/img_header_logotmb_red.png"
    },
    {
      "id": 5,
      "title": "AMB – Mobilitat urbana",
      "description": "Afeccions a carreteres, accidents, info ZBE i transport públic",
      "format": "CSV / JSON",
      "lastUpdate": "20/10/2025",
      "category": "Mobilitat",
      "coverage": "Comarques de l'AMB",
      "link": "https://www.amb.cat/s/web/mobilitat/mobilitat.html",
      "logo": "data:image/jpeg;base64,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"
    },
    {
      "id": 6,
      "title": "Rodalies – Incidències",
      "description": "Incidències ferroviàries del servei de Rodalies",
      "format": "XML",
      "lastUpdate": "20/10/2025",
      "category": "Transport públic",
      "coverage": "Barcelona i municipis propers",
      "link": "https://www.gencat.cat/rodalies/incidencies_rodalies_rss_ca_ES.xml",
      "logo": "data:image/jpeg;base64,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"
    },
    {
      "id": 7,
      "title": "DGT 3.0 – Trànsit temps real",
      "description": "Informació general de trànsit i alertes en temps real",
      "format": "API REST",
      "lastUpdate": "20/10/2025",
      "category": "Mobilitat",
      "coverage": "Espanya",
      "link": "https://github.com/dgt30-esp",
      "logo": "data:image/png;base64,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"
    }
]
app = FastAPI(title="Proyecto PAE - Backend (SQLite)")

app.add_middleware(
    CORSMiddleware,
    allow_origins=[os.getenv("FRONTEND_ORIGIN", "http://localhost:3000")],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

engine = create_engine(DATABASE_URL, echo=False, connect_args={"check_same_thread": False} if DATABASE_URL.startswith("sqlite") else {})

def get_session():
    with Session(engine) as session:
        yield session

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")  # for FastAPI docs

# Token helpers
def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):
    to_encode = data.copy()
    now = datetime.now(timezone.utc)
    expire = now + (expires_delta or timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES))
    to_encode.update({"exp": expire, "iat": now})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt

def create_refresh_token(user_id: int, expires_delta: Optional[timedelta] = None):
    jti = str(uuid.uuid4())
    now = datetime.now(timezone.utc)
    expire = now + (expires_delta or timedelta(days=REFRESH_TOKEN_EXPIRE_DAYS))
    payload = {"jti": jti, "sub": str(user_id), "exp": expire, "iat": now}
    token = jwt.encode(payload, SECRET_KEY, algorithm=ALGORITHM)
    return token, jti, expire

def verify_access_token(token: str):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        user_id = int(payload.get("sub"))
        return user_id
    except JWTError:
        raise HTTPException(status_code=401, detail="Token inválido o expirado")

# Dependency: validates Authorization Bearer <access_token>
def get_current_user(token: str = Depends(oauth2_scheme), session: Session = Depends(get_session)):
    if not token:
        raise HTTPException(status_code=401, detail="No se ha proporcionado token")
    user_id = verify_access_token(token)
    user = session.get(User, user_id)
    if not user:
        raise HTTPException(status_code=401, detail="Usuario no válido")
    return user

@app.on_event("startup")
def on_startup():
    SQLModel.metadata.create_all(engine)
    with Session(engine) as session:
        count = session.exec(select(Dataset)).all()
        if len(count) == 0:
            for d in DATASETS:
                if session.get(Dataset, d["id"]) is None:
                    session.add(Dataset(**d))
            session.commit()
        if not session.exec(select(User).where(User.username == "admin")).first():
            hashed = pwd_context.hash("admin")
            session.add(User(username="admin", hashed_password=hashed))
            session.commit()

# --- Auth endpoints (tokens in JSON body) ---

@app.post("/login")
def login(data: dict, session: Session = Depends(get_session)):
    username = data.get("username")
    password = data.get("password")
    user = session.exec(select(User).where(User.username == username)).first()
    if not user or not pwd_context.verify(password, user.hashed_password):
        raise HTTPException(status_code=401, detail="Usuario o contraseña incorrectos")

    access_token = create_access_token({"sub": str(user.id)})
    refresh_token, jti, expires_at = create_refresh_token(user.id)

    rt = RefreshToken(jti=jti, user_id=user.id, expires_at=expires_at, revoked=False)
    session.add(rt)
    session.commit()

    # RETURN both tokens in JSON (client will store refresh token)
    return {"access_token": access_token, "refresh_token": refresh_token, "token_type": "bearer", "username": username}

@app.post("/refresh")
def refresh(data: dict, session: Session = Depends(get_session)):
    refresh_token = data.get("refresh_token")
    if not refresh_token:
        raise HTTPException(status_code=401, detail="No refresh token")
    try:
        payload = jwt.decode(refresh_token, SECRET_KEY, algorithms=[ALGORITHM])
        jti = payload.get("jti")
        user_id = int(payload.get("sub"))
    except JWTError:
        raise HTTPException(status_code=401, detail="Refresh token inválido")

    rt = session.exec(select(RefreshToken).where(RefreshToken.jti == jti)).first()
    if not rt or rt.revoked:
        raise HTTPException(status_code=401, detail="Refresh token revocado o no encontrado")

    expires_at = rt.expires_at
    if expires_at.tzinfo is None or expires_at.tzinfo.utcoffset(expires_at) is None:
        expires_at = expires_at.replace(tzinfo=timezone.utc)

    if expires_at < datetime.now(timezone.utc):
        raise HTTPException(status_code=401, detail="Refresh token expirado")

    # rotate: revoke old and create new
    rt.revoked = True
    session.add(rt)
    new_refresh_token, new_jti, new_expires_at = create_refresh_token(user_id)
    new_rt = RefreshToken(jti=new_jti, user_id=user_id, expires_at=new_expires_at, revoked=False)
    session.add(new_rt)
    session.commit()

    access_token = create_access_token({"sub": str(user_id)})
    return {"access_token": access_token, "refresh_token": new_refresh_token, "token_type": "bearer"}

@app.post("/logout")
def logout(data: dict, session: Session = Depends(get_session)):
    refresh_token = data.get("refresh_token")
    if refresh_token:
        try:
            payload = jwt.decode(refresh_token, SECRET_KEY, algorithms=[ALGORITHM])
            jti = payload.get("jti")
            rt = session.exec(select(RefreshToken).where(RefreshToken.jti == jti)).first()
            if rt:
                rt.revoked = True
                session.add(rt)
                session.commit()
        except JWTError:
            pass
    return {"msg": "Logged out"}

@app.get("/me")
def me(token: str = Depends(oauth2_scheme), session: Session = Depends(get_session)):
    user_id = verify_access_token(token)
    user = session.get(User, user_id)
    return {"username": user.username}

# --- Public endpoints ---
@app.get("/datasets", response_model=List[Dataset])
def list_datasets(session: Session = Depends(get_session)):
    results = session.exec(select(Dataset).order_by(Dataset.id)).all()
    return results

@app.get("/datasets/{dataset_id}", response_model=Dataset)
def get_dataset(dataset_id: int, session: Session = Depends(get_session)):
    ds = session.get(Dataset, dataset_id)
    if not ds:
        raise HTTPException(status_code=404, detail="Dataset no encontrado")
    return ds

# --- Protected endpoints ---
@app.post("/datasets", response_model=Dataset, status_code=201)
def create_dataset(payload: Dataset, user: User = Depends(get_current_user), session: Session = Depends(get_session)):
    if session.get(Dataset, payload.id):
        raise HTTPException(status_code=400, detail="Dataset con ese id ya existe")
    session.add(payload)
    session.commit()
    session.refresh(payload)
    return payload

@app.put("/datasets/{dataset_id}", response_model=Dataset)
def update_dataset(dataset_id: int, payload: Dataset, user: User = Depends(get_current_user), session: Session = Depends(get_session)):
    existing = session.get(Dataset, dataset_id)
    if not existing:
        raise HTTPException(status_code=404, detail="Dataset no encontrado")
    for field in payload.__fields_set__:
        setattr(existing, field, getattr(payload, field))
    session.add(existing)
    session.commit()
    session.refresh(existing)
    return existing

@app.delete("/datasets/{dataset_id}", status_code=204)
def delete_dataset(dataset_id: int, user: User = Depends(get_current_user), session: Session = Depends(get_session)):
    existing = session.get(Dataset, dataset_id)
    if not existing:
        raise HTTPException(status_code=404, detail="Dataset no encontrado")
    session.delete(existing)
    session.commit()
    return

@app.get("/configuracion")
def configuracion(user: User = Depends(get_current_user)):
    return {"config": "Solo admin puede ver esto"}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run("main:app", host="127.0.0.1", port=8000, reload=True)